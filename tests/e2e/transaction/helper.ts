// Copyright Â© Aptos Foundation
// SPDX-License-Identifier: Apache-2.0

import {
  Account,
  Aptos,
  AccountAddress,
  UserTransactionResponse,
  TypeTag,
  EntryFunctionArgumentTypes,
  GenerateFeePayerRawTransactionInput,
  GenerateMultiAgentRawTransactionInput,
  HexInput,
} from "../../../src";
import { MoveVector } from "../../../src/bcs/serializable/moveStructs";
import { FUND_AMOUNT } from "../../unit/helper";

export async function publishModule(
  aptos: Aptos,
  senderAccount: Account,
  metadataBytes: HexInput,
  codeBytes: HexInput,
) {
  const rawTransaction = await aptos.generateTransaction({
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: "0x1::code::publish_package_txn",
      functionArguments: [MoveVector.U8(metadataBytes), new MoveVector([MoveVector.U8(codeBytes)])],
    },
  });
  const signedTxn = await aptos.signTransaction({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  const txnHash = await aptos.submitTransaction({
    transaction: rawTransaction,
    senderAuthenticator: signedTxn,
  });
  return (await aptos.waitForTransaction({ transactionHash: txnHash.hash })) as UserTransactionResponse;
}

export async function fundAccounts(aptos: Aptos, accounts: Array<Account>) {
  // eslint-disable-next-line no-restricted-syntax
  for (const account of accounts) {
    // eslint-disable-next-line no-await-in-loop
    await aptos.fundAccount({ accountAddress: account.accountAddress.toString(), amount: FUND_AMOUNT });
  }
}

// Transaction builder helpers
// single signer
export async function rawTransactionHelper(
  aptos: Aptos,
  publisherAccount: Account,
  senderAccount: Account,
  functionName: string,
  typeArgs: TypeTag[],
  args: Array<EntryFunctionArgumentTypes>,
): Promise<UserTransactionResponse> {
  const rawTransaction = await aptos.generateTransaction({
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: `${senderAccount.accountAddress.toString()}::tx_args_module::${functionName}`,
      typeArguments: typeArgs,
      functionArguments: args,
    },
  });
  const senderAuthenticator = await aptos.signTransaction({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  const transactionResponse = await aptos.submitTransaction({
    transaction: rawTransaction,
    senderAuthenticator,
  });
  const response = await aptos.waitForTransaction({
    transactionHash: transactionResponse.hash,
  });
  return response as UserTransactionResponse;
}

// multi agent/fee payer
export const rawTransactionMultiAgentHelper = async (
  aptos: Aptos,
  publisherAccount: Account,
  senderAccount: Account,
  functionName: string,
  typeArgs: Array<TypeTag>,
  args: Array<EntryFunctionArgumentTypes>,
  secondarySignerAccounts: Array<Account>,
  feePayerAccount?: Account,
): Promise<UserTransactionResponse> => {
  // TODO: Combine these to one type later. This should be possible but isn't right now due to typescript
  // compile time errors because it can't resolve the types
  const transactionData = {
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: `${senderAccount.accountAddress.toString()}::tx_args_module::${functionName}`,
      typeArguments: typeArgs,
      functionArguments: args,
    },
  };
  const generatedTransaction = await (async () => {
    let transaction;
    if (secondarySignerAccounts.length === 0) {
      transaction = await aptos.generateTransaction({
        ...transactionData,
        feePayerAddress: feePayerAccount?.accountAddress.data,
      } as GenerateFeePayerRawTransactionInput);
    } else if (feePayerAccount === undefined) {
      transaction = await aptos.generateTransaction({
        ...transactionData,
        secondarySignerAddresses: secondarySignerAccounts.map((account) => account.accountAddress.data),
      } as GenerateMultiAgentRawTransactionInput);
    } else {
      transaction = await aptos.generateTransaction({
        ...transactionData,
        secondarySignerAddresses: secondarySignerAccounts.map((account) => account.accountAddress.data),
        feePayerAddress: feePayerAccount?.accountAddress.data,
      } as GenerateFeePayerRawTransactionInput);
    }
    return transaction;
  })();

  const senderAuthenticator = aptos.signTransaction({
    signer: senderAccount,
    transaction: generatedTransaction,
  });

  const secondaryAuthenticators = secondarySignerAccounts.map((account) =>
    aptos.signTransaction({
      signer: account,
      transaction: generatedTransaction,
    }),
  );

  let feePayerAuthenticator;
  if (feePayerAccount !== undefined) {
    feePayerAuthenticator = aptos.signTransaction({
      signer: feePayerAccount,
      transaction: generatedTransaction,
    });
  }

  const transactionResponse = await aptos.submitTransaction({
    transaction: generatedTransaction,
    senderAuthenticator,
    secondarySignerAuthenticators: {
      additionalSignersAuthenticators: secondaryAuthenticators,
      feePayerAuthenticator,
    },
  });

  const response = await aptos.waitForTransaction({ transactionHash: transactionResponse.hash });
  return response as UserTransactionResponse;
};

// hard-coded bytecode for the contract, so we don't have to recompile it every time in ci
export const ARGUMENT_TESTS_CONTRACT_METADATA =
  // eslint-disable-next-line max-len
  "0x25417267756d656e7420546573747320666f722074686520547970657363726970742053444b0100000000000000004041393632313444413743394136423337324342444334313530334130443943384546323438443633434243313143393236363638303639393341313946344632f2011f8b08000000000002ffa5903f4fc33010c5777f0acb7bd25662ed5009b13030902daaa2abf35c421a9f659b00427c77ec24441dba55f67277effdee4fed48f774c651581a20f7521dfcf963808db24288411af632be4156df0e41fbce45f9faf8acc4081f3ab6d9b12dd35342d42d1c6c0bab3b84a338b8c8e1c927ec27fb3e097fe485355db2a52c37eba7ac2b347b14bb251878c4c6fc5b97e41a2bf93bc32bee615f4eefd069d0bbf931d30a9e71b987a8a96d3d42c8db4c9ac65cada3b65f3bb5e4276fc3eb28a9f6a044f46403e998eed4d072d6a9daccd71a8bab0637c5fb043a01469381fa0357683d82ac010000010e74785f617267735f6d6f64756c65f81c1f8b08000000000002ffed5c6d6fe33612fede5fc1eb01a98dd3b516f562d9d92cbabb31b601b2c95ee2142d8240506c3ad1d5b15c4bce6eaeddff7e1c4994488a9498dd02d72b142491440e9f190e39c32129ea2159eed70465bb6893468b2c4e3661b4bbdb3f904d964ea7d947784ac38782eab7af10fdd9a704a5d9723a4db35dbcb93b1413c96e97eca4b434bedb1039f1912cb20665b20511a6d3df2ec97a65a1f3fcf1934c74fb6f5ab626ca1f65a242b8e9f4522564f6b42561bc592525082d9c137cf7dd77687e4f50211b5a93cd5d769fa26847d026c910f9751fadbfcd2917c926cdd0c9d99bf38b8bd99b79f823fd777e119ececedece7f98a2bdefa223648f4687026ebca17a60e88fd17a4f5ac04bc81f5f9d5ecd2ec3b3f37938fbd7d5ab53068e79f04251c846714ac13604459b254bc43471f34dc6439fbf9f9f9c9f157827f39fc3d9c505e53462d08e0e3a4d1e3e0fda66d0ae129a16cda27843958196f16a4576b4fb15fa41d97db4a9d87533c28c91078c38f2d7af2e6725cd9bf3e359f8feeaf5e9c99bf0d5c5dbab77b3b3f925d7664c4475c17757a7f393f0f2e4edd9ec826b0ba1ccf1ecfde9f9cfb30b4a7c390fdfbd9abff9217c777e7c753a0b5f1d1f5fcc2e2b7663fa73489581463fd9c4b77989dfbdfa29bc0a2861001c3cef50ceb37d9a69fb34d7f73ca799ef80321c0c5ac71377e28ff1a449e4bbe1eb93b755ed03d7f5c7ae3b1a3be3d1c4f36cdf56f0c5415986de4177714738c08eef4ff068e204aeefd05f67ecfaa3b1ebd8633fc0b6ed2ae4c79e5fe2d03b606e7b630a114cb0337628e789e762c7a37204b431033f184f46e3c073b03f995026bee7bb23f87326ae37f602dab3c613dbb1f1c47726135007c76ff6d37b6a4db3e3f0f5f939b5a0db24595386d96e4f0e555495da6d7576ad79ac26a855efa8097cb7b2080d0b1c540af6d424546b95ee7c2549d5d9a2e57247d294127eaf74f5cad297f38b9333da3c85bf7ab10f5ed2f2b75f938f5b9a409661e162bf562bbaf45e85be4b04503b60088fd77933586815ad537a810774c37c04357f8256c97a9d7ca0aca8ffccc81df5a0e0bfd332bd24d93d44d994951a59c8b610b6a09fa17fd637767ed3222e34bc505deee1ba86c59e03ff5cf8e731693588d057188aedf398f0c48182113bc5c52d2e5dd0d0cb189883796878e2a02bfb77b87b97bbefe204dd9561fb2ecf099e384e0a07e228535d656aa73231d740f4415027161bc9cc2d39a684ae2961571d72b36542d307be0ef923afce3fd2253a7f309efb07e37528ae7266a5b24a9fc6a9af4ab946df8f3e5225d2ffd1ed22bf2ec92abfdad8c9afaee7e7d7713069672b79c1da21708cf9c46b858bb4681a1524bf5241f22b1524bf5241f22b15e46b9024178596db2f327449b2fdf638ca22741fa5e817f25486e0f0431eb6d95358c4c2105f1561f08b19245f9034d9ef16e4a5a526c7cf23775ac93f09220b14b5d88c6ab5df502f1e67e59462b024db75f24476537450cc12865c15a33425bbec6f8322673a2ddb374c5655b9213ad28d69964118363cac98ad4986687dd3ba5595758606be114bc5b4c8a84efa701fd38ac5e80572f8ca30eabc9781aa925db8232b5a96cd67163b1265a454fa405d294e604ee8b0d010877547e833a01539830389ad84f3903c92304b064222fc1cd4e85623536cebdf3e89146a513919cbdeb5da250fa1245e97bc450b4da7db7d7a1fde468b5f06070ffba2fd2cf82f91430bc5e81f2c9ccb7b6d7dcbc076e491ec52524349bd23056b0c97608e479c698a4d2c9b652569b295041d5afa82f8730b3a8605d98c57dbf8ccc0445eb50aeaf4524ba5816ff7b7eb7881685fdd3de5d69ecfb5b3e82e7d31a71e794ec7b5391dd8e6d40bcfe90032f7e81ff5c4f331fd0be8df04687242a0b48114228839040c731ba86d20b781de86023694c05002e7d850027cfc1c43090c253094c0500243093c793950b919a1a6dc12417e9baca8fc508efa1b455e1ecbd2dc83834e145b8f420710330cdc8241c34a3310a705c4c186206e0b88ef1a82786dd5c1a64af15b5020b0324319eb51587c610614e8818a4529439c891e473d421976c396decc4fd04ce1ec4e38088f0cc1703718ede6a6684e371aedefa6686e371aedf8a6689e414db1b9e2fc6e38300553b871271cb3890291e27483069da0a57d984a39e904541b8aa9b36db1946265f2599682ed4e38734bc1b81bccdc52b0d38d666e29d8ed4633b714ec19d4d4dc52b0df0df70c4bc1e34e38d152ba11834ec4e799099e74026acd448c0247a6b15f9150cf5eea102b8c168b64bfc943e403797e41e943b0a862a1564cdfe74bb3525ab91e2ba5968bb0526ab9f22a23b0e55629bd5a6315d3cbb6ac1656c5dc72ef0915ed23e695939faef977e1b7c23cb6e797241b14859ef801bb41b20f5a11f6d20a6593405a676c1248cb830a16f2ba5d93a4b12cd620a9942e0d3d0d42a67f71346990b1a6681d23ea52c5de246b92da5337288a26e14786060934490b42de249cfb6e124093701eb949004dc23959050bccc920360923c99b8477860d92aa49241fd720644d227aae0659651d6dfea82e4597fa97844e549fc20d4961bdcdae5bb340503e31bf497f2cc0989f1f9feb31b10653bc08638621b2f31c648d6f6eb21aa268f1eb3ea6eda05ca460b35de664614410b6c7accebd52ba9232e2d6467844d8353be237d28cd06c1d1aecb11d091b6f46785887075b7247c23e9d119ea3c3831dbc23615bcf08cfd5d6174bfa8311c904d1d321e6db8347e2aea111a2af41acb6128f1afb8c46b8630d6ee1210096bdbab1cf56c140da8d1c1af108343c0af7023cee4816d68b5983e1b7e2ba9d119749834b58986c1ae62f730cf841dce286e0eb1b33ab181932c8a324e5d6ab191fdb900f8dbb143ba6663cb0290f3071c526aa1917c7940b18be623fd58c8b6bca05dc81622fd58c8b67ac31ac6a1753cf61fba67c72cfa1dace34e33336e4c3426add06a019b7c0905be16cacdc2154db7642dec0cce7d8a6eea0f03105c78c060265425a521bb2c30ae75004518c1d1faf5a88bd59076f8715ebcc666c6c4336850f625ce045b181105518b2c386ecc015a9995d0543cb849363ca097c8f8615b51db36ab9a6ccc005699839d8ac629e292f70441a5ebe6bc6cb375622d63718cd3354e3d8945dee9434ec689e21bbc0905de5b1d41cd95eb319d3892153e6b8049eada1939900cea8b9298e3a0326339999eb136486ed5a33c96c71b9894e7ade449b6f32744bd0225aafc912c15e328a50bad8c5db0c6da3a775122d73626e516a173fc2ceb86255aa5f94ea17a5fa45a97e51eab317a53ad65ef4ebe182f7b12a676395eec5622ec5625ec4628ec3aa7c855579078bf7071667fe1667ee96e28d1a71ae5a8ac0cdfef8491a3f95e2273cc2b444983bc801be14828bf1b1209d2a9615424e2e20e423363ea0e2031e212011c205793097c6d98674cfdc01091ff6eb2cdeaed98b59a6834f99875bf29c963cb725cf53e415cf4c17a4cdbdf5e3623f2ef6e3623f2e7ec9b898bf5d29b99c700b338925dda856bde02dbe95d87c3fb872a6d2d6750b29362775cc495d73528f23bde9584b92b565b5e8cf6a3dc336e4de04ede393bf787cd2320bee23933e32e923933e32e92393b6197b8b97948748e618eb5ba7be75eb5baf3976f703ecffeb001b6fd6f186e423ac2a6e7b319fa2e52ed9be84cd40ee6da5f9cbbcf6dcbb4690024d156f96e4633ed4a88eacb0b33ec5972a68a1c1410e9cbfe7a9c9a4712ecabfd2319dc69bc7681dc331451a0a0c345fb3a02bef9520c361f3d8d47fe2ed8bb985e6659dca8a58e8f7c842b7bf4bc7a3aab73140c05b8d204a769fba142dec38406dcb06b32b3f003a2d13b190a85774bc4203b65b11a761be7b0a8a64d8c3a1a6822d85b40da0f92c87ae013e21b24e49377fd865f902feb68e3f9bb9913501df0827fb4aa6b70985ff202aeab0554cf605905a488be13e4f5aacd516df7bfe7efd18930f37fc9a1df424480ce94e92726fa88f26fb68b28f26fb68b2359a9ca2da63887e82f70f825b10bc81e00444d3970c5eb671d9ae8d6c59657b6a835552aa2c53698d4a0b541b9ddaceb476a533a44ecb51f574b579b4508a0a50f67d657f57777175afd6f6625db7359af5d45183348361138f462adf81b9414e91c877686e885315c72a50a1a34ba35b3323953abe38a8b54c725439cdaad7931f65b2ac006e52a44c97d5c04f9694190d65489328559e4a25a6932b554e532bf5a44b992c6b859b8c29d365adf093346546432bd2e44d95a7d28a6e5267102cb6bd312a0ff39cb9b169d343b41da8bf3543a74ea93c6f125eec4a87dcac48332992dfd7a24ba9aaf58d22520fefd6c92d9d3455142f759f1f31d40bff5e2bf01ea84723f49c64933d24fe0b1db2060e351eafa6910f01189161333247d3b9a42653be10dc110d4a4a18d487182a11d99d332c152336d0a1d9e089ae511b36ba797eefa8d7bcf26e52af584937068dff45f516bb84f4859a5206491d8303c650dae27b5e69fc45a5f99d48c938a1aad577928e74df482a971ef1117c2bab7a74e0f1b67a74e171513d7af0b8b4d022d911b8b58737d5c79d7205c3149a3ee4ccb82974e3634f8d6d1daccf72f459ae3e4bb58504624bc91dddabfa70ec8a44d99e52896fc896a9b48bb17cf8001355c33e5e0abdacce5edc479b3b129609e16a1ddda503108cad825e97593755c20dbf530b6c993aeb2359a8ed4b5987aaed76dc5e9851a90b3b46851d7561d7a8b0ab2eec1915f6788da9be3a66bef7adfe1c92786e529d7515e832e420493896a8c9910325f1a4a026ab112c350eeee9638dc6f93b81b4eb189d22022d0fc0a9e5e18faeb55268b5ca9d186b27d0ea983ba7d5c1027709a157bc74a4a9a154ed51a406a5fa089122c815cefe28f355a7760c08e1c48d09199c9631a173b0199def1af2c58602e627430c08ab031d7ada8e8318fa821d163514369e6ae7a53fd3d07bafde7bf5deabf75e7f3eefc56e3ff7650bcd272acb905599ea28535d65aaa7b47fee1bc372fc6d35826aab11295b8df0d76ac4b416bae91d75efa87b47dd3bea3f7b98d97be8de43f71ebaf7d0bd87fedf7a68b8d085ff4f5ffd171bb35147d06d000000000400000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c69620000000000000000000000000000000000000000000000000000000000000004114170746f73546f6b656e4f626a6563747300";

const ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH = "0a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b76993451";

// interpolate a named address into the contract bytecode
export async function getContractBytecode(deploymentAddress: AccountAddress) {
  let firstString =
    // eslint-disable-next-line max-len
    "0xa11ceb0b060000000c0100100210200330a50104d501f80105cd03f70707c40bb80408fc0f4006bc10aa0710e61782020ae8191a0c821a82250d843f06000001010102010301040105010601070008080000090800050a0700020d07010001031007010000021e0200062a0700000b000100000c000200000e000300000f0400000011050000001206000000130500000014060000001500001e0000000000000000000000000000000000000000000000000000000000000016070700071b0b000100051c0a0900021d0d0e0108041f040e0002200e1200022113140002221315010801231818000324001e010003251f19010003261f19010003271f2001000328211901000329221e0100062b002501000a0a0c0c100c0a110a170a190a1a0a1b0a180a1c0a1d0a0e0a0912171317141715171617171913191419151916191717171a131a141a151a161a171b131b141b151b161b17181318141815181618171c131c141c151c161c171d131d141d151d161d170e130e140e150e160e170913091409150916091711131114111511161118221819182618171827181a1828181b18291818182a181c182b181d182c180e182d1809182e1811182f18301831180a18321833183418351836183718381839183a183b183c183d183e1801183f1840184118421843184418451846184718481849184a184b184c184d184e184f1850185118521853185400010a080203050505030b030108000b030108000b0301080001060c21060c01020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080026060c060c060c060c060c0a0501020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108002001020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080007070a08020a02030a08020a020a0a020a0a02010802010a0201070a090001080001060b03010900010501060801060805030b030108000c0a0b030108000801010b0301080001080501060805010c010b0301090089010a0b0301080003030303030303030303030303030303030303030303060206010602060d060e06030604060f0605060802060b0301080003030303030303030303030b030108000b030108000b030108000b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b03010800010201030101010d010e0104010f010b0401090001060b040109000106090002060b040109000609000109000903030a050a050a050a050a050a050a051d010101010101010101010101010101010101010101010101010101010101080601090101090201090301090401090501090601090701090801090901090a010a0101090b01090c010a0d01090d010a0e01090e010a0301090f010a04010910010a0f010911010a05010912010913010a0b03010800010914010b040101010915010b040102010916010b04010d010917010b04010e010918010b040103010919010b04010401091a010b04010f01091b010b04010501091c010b0401080201091d010b04010b030108000e74785f617267735f6d6f64756c65056572726f72066f626a656374066f7074696f6e067369676e657206737472696e6709747970655f696e666f06766563746f720d456d7074795265736f757263650953657475704461746106537472696e671a6765745f65787065637465645f766563746f725f737472696e67196765745f746573745f6f626a6563745f616464726573736573064f626a656374106765745f746573745f6f626a656374730b696e69745f6d6f64756c65064f7074696f6e11707269766174655f617267756d656e747322707269766174655f617267756d656e74735f6d756c7469706c655f7369676e657273107075626c69635f617267756d656e7473217075626c69635f617267756d656e74735f6d756c7469706c655f7369676e65727309747970655f7461677312766965775f616c6c5f617267756d656e74730b64756d6d795f6669656c640e656d7074795f6f626a6563745f310e656d7074795f6f626a6563745f320e656d7074795f6f626a6563745f33077265766572736504757466380e6f626a6563745f616464726573730e436f6e7374727563746f725265660a616464726573735f6f660d6372656174655f6f626a6563740f67656e65726174655f7369676e65721b6f626a6563745f66726f6d5f636f6e7374727563746f725f7265660d696e76616c69645f7374617465046e6f6e650769735f6e6f6e650769735f736f6d6506626f72726f7708636f6e7461696e7304736f6d650854797065496e666f07747970655f6f660a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b7699345100000000000000000000000000000000000000000000000000000000000000010308d007000000000000030810270000000000000308611e00000000000005200a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b769934510101010a02100f65787065637465645f737472696e670410050000000000000000000000000000000d0202000f2006000000000000000000000000000000000000000000000000000000000000000e0403000000030804000000000000000201010a05c1010600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abc0000000000000000000000000000000000000000000000000000000000000def0000000000000000000000000000000000000000000000000000000000000123000000000000000000000000000000000000000000000000000000000000045600000000000000000000000000000000000000000000000000000000000007890a0104030100010a0a0225060f65787065637465645f737472696e6703616263036465660331323303343536033738390a046106000000000000000000000000000000000100000000000000000000000000000002000000000000000000000000000000fdfffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0d0d06000001000200fdfffeffffff0a0fc10106000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000fdfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0e1906000000000100000002000000fdfffffffeffffffffffffff0a033106000000000000000001000000000000000200000000000000fdfffffffffffffffeffffffffffffffffffffffffffffff0a020706000102fdfeff030864000000000000000410ffffffffffffffffffffffffffffffff0d02ffff0f20ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0e04ffffffff0308ffffffffffffffff0201ff03082c01000000000000030890010000000000000308f4010000000000000308c8000000000000000a020100126170746f733a3a6d657461646174615f7631ed010601000000000000000b45585045435445445f55380002000000000000000c45585045435445445f5531360003000000000000000c45585045435445445f5533320004000000000000000c45585045435445445f5536340005000000000000000d45585045435445445f553132380006000000000000000d45585045435445445f55323536000004106765745f746573745f6f626a6563747301010012766965775f616c6c5f617267756d656e7473010100196765745f746573745f6f626a6563745f6164647265737365730101001a6765745f65787065637465645f766563746f725f737472696e670101000002011701010203180b03010800190b030108001a0b03010800000100000824400900000000000000000c03070e0c050d0538000b050c060e06410a0c020a0206000000000000000024042005100d06450a0c010d030c000b010c040b000b04110b44090b02060100000000000000170c02050b0b06460a00000000000000000b03020101000101030b11020c020c010c000e0038010e0138010e0238010202010001010f0d07032b010c000a001000140a001001140b00100214020300000010360a00110d0703210406050a0b0001070227401100000000000000000c050600000000000000000c020a0206030000000000000023042805130703110e0c010e01110f0c040e040912002d000e0138020c030d050b0344110b02060100000000000000160c02050e0d0538030d0545110d0545110d05451112010c060b000b062d0102040004010100230b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b20110602050004010100280b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b25110702060104010116b20a0b0107042104050509070106000000000000000016270b02070b21040e0512070106010000000000000016270b030707210417051b070106020000000000000016270b0407092104200524070106030000000000000016270b05070a210429052d070106040000000000000016270b0607062104320536070106050000000000000016270b07070821043b053f070106060000000000000016270b0807032104440548070106070000000000000016270b090705110b21044e0552070106080000000000000016270b0a07032b0110001421045a055e070106090000000000000016270b0b07200701060a00000000000000160c220c9f010c94010e940141170e9f01411721046d057207150b22161111270b94010b9f010c7e0c680d6838040d7e38040b680b7e0c7f0c690e6941170c430a430e7f411721048701058901060200020000000000270a4306000000000000000024049d01058e010d6945170d7f4517210495010598010b221111270b43060100000000000000170c430589010b69461700000000000000000b7f461700000000000000000b0c070d0701060b00000000000000160c230ca0010c95010e950141190ea00141192104b00105b50107150b23161111270b95010ba0010c80010c6a0d6a38050d800138050b6a0b80010c81010c6b0e6b41190c440a440e810141192104ca0105cc01060200020000000000270a440600000000000000002404e00105d1010d6b45190d810145192104d80105db010b231111270b44060100000000000000170c4405cc010b6b461900000000000000000b8101461900000000000000000b0d07140701060c00000000000000160c240ca1010c96010e960141170ea10141172104f30105f80107150b24161111270b96010ba1010c82010c6c0d6c38040d820138040b6c0b82010c83010c6d0e6d41170c450a450e8301411721048d02058f02060200020000000000270a450600000000000000002404a3020594020d6d45170d8301451721049b02059e020b241111270b45060100000000000000170c45058f020b6d461700000000000000000b8301461700000000000000000b0e07100701060d00000000000000160c250ca2010c97010e9701411a0ea201411a2104b60205bb0207150b25161111270b97010ba2010c84010c6e0d6e38060d840138060b6e0b84010c85010c6f0e6f411a0c460a460e8501411a2104d00205d202060200020000000000270a460600000000000000002404e60205d7020d6f451a0d8501451a2104de0205e1020b251111270b46060100000000000000170c4605d2020b6f461a00000000000000000b8501461a00000000000000000b0f07120701060e00000000000000160c260ca3010c98010e9801411b0ea301411b2104f90205fe0207150b26161111270b98010ba3010c86010c700d7038070d860138070b700b86010c87010c710e71411b0c470a470e8701411b21049303059503060200020000000000270a470600000000000000002404a903059a030d71451b0d8701451b2104a10305a4030b261111270b47060100000000000000170c470595030b71461b00000000000000000b8701461b00000000000000000b1007130701060f00000000000000160c270ca4010c99010e990141180ea40141182104bc0305c10307150b27161111270b99010ba4010c88010c720d7238080d880138080b720b88010c89010c730e7341180c480a480e890141182104d60305d803060200020000000000270a480600000000000000002404ec0305dd030d7345180d890145182104e40305e7030b271111270b48060100000000000000170c4805d8030b73461800000000000000000b8901461800000000000000000b11070f0701061000000000000000160c280ca5010c9a010e9a01411c0ea501411c2104ff0305840407150b28161111270b9a010ba5010c8a010c740d7438090d8a0138090b740b8a010c8b010c750e75411c0c490a490e8b01411c21049904059b04060200020000000000270a490600000000000000002404af0405a0040d75451c0d8b01451c2104a70405aa040b281111270b49060100000000000000170c49059b040b75461c00000000000000000b8b01461c00000000000000000b1207110701061100000000000000160c290ca6010c9b010e9b01411d0ea601411d2104c20405c70407150b29161111270b9b010ba6010c8c010c760d76380a0d8c01380a0b760b8c010c8d010c770e77411d0c4a0a4a0e8d01411d2104dc0405de04060200020000000000270a4a0600000000000000002404f20405e3040d77451d0d8d01451d2104ea0405ed040b291111270b4a060100000000000000170c4a05de040b77461d00000000000000000b8d01461d00000000000000000b13070c0701061200000000000000160c2a0ca7010c9c010e9c01410e0ea701410e21048505058a0507150b2a161111270b9c010ba7010c8e010c780d78380b0d8e01380b0b780b8e010c8f010c790e79410e0c4b0a4b0e8f01410e21049f0505a105060200020000000000270a4b0600000000000000002404b50505a6050d79450e0d8f01450e2104ad0505b0050b2a1111270b4b060100000000000000170c4b05a1050b79460e00000000000000000b8f01460e00000000000000000b1411000701061300000000000000160c2b0ca8010c9d010e9d0141090ea80141092104c80505cd0507150b2b161111270b9d010ba8010c90010c7a0d7a380c0d9001380c0b7a0b90010c91010c7b0e7b41090c4c0a4c0e910141092104e20505e405060200020000000000270a4c0600000000000000002404f80505e9050d7b45090d910145092104f00505f3050b2b1111270b4c060100000000000000170c4c05e4050b7b460900000000000000000b9101460900000000000000000b150c2111020c510c500c4f0b210b4f0b500b51401103000000000000000701061400000000000000160c2c0ca9010c9e010e9e0141110ea90141112104940605990607150b2c161111270b9e010ba9010c92010c7c0d7c38030d920138030b7c0b92010c93010c7d0e7d41110c4d0a4d0e930141112104ae0605b006060200020000000000270a4d0600000000000000002404c40605b5060d7d45110d930145112104bc0605bf060b2c1111270b4d060100000000000000170c4d05b0060b7d461100000000000000000b9301461100000000000000000b16380d0701061500000000000000160c2d0c5d0c520e52380e04dd060e5d380e04d70605dc06071c0b2d1611112705f3060e5d380f04e10605e606071d0b2d161111270e5238100c380e5d0b38381104ee0605f306071e0b2d161111270b17070438120701061600000000000000160c2e0c5e0c530e5338130489070e5e3813048307058807071c0b2e16111127059f070e5e3814048d07059207071d0b2e161111270e5338150c390e5e0b393816049a07059f07071e0b2e161111270b18070b38170701061700000000000000160c2f0c5f0c540e54380e04b5070e5f380e04af0705b407071c0b2f1611112705cb070e5f380f04b90705be07071d0b2f161111270e5438100c3a0e5f0b3a381104c60705cb07071e0b2f161111270b19070738180701061800000000000000160c300c600c550e55381904e1070e60381904db0705e007071c0b301611112705f7070e60381a04e50705ea07071d0b30161111270e55381b0c3b0e600b3b381c04f20705f707071e0b30161111270b1a0709381d0701061900000000000000160c310c610c560e56381e048d080e61381e048708058c08071c0b311611112705a3080e61381f049108059608071d0b31161111270e5638200c3c0e610b3c3821049e0805a308071e0b31161111270b1b070a38220701061a00000000000000160c320c620c570e57382304b9080e62382304b30805b808071c0b321611112705cf080e62382404bd0805c208071d0b32161111270e5738250c3d0e620b3d382604ca0805cf08071e0b32161111270b1c070638270701061b00000000000000160c330c630c580e58382804e5080e63382804df0805e408071c0b331611112705fb080e63382904e90805ee08071d0b33161111270e58382a0c3e0e630b3e382b04f60805fb08071e0b33161111270b1d0708382c0701061c00000000000000160c340c640c590e59382d0491090e64382d048b09059009071c0b341611112705a7090e64382e049509059a09071d0b34161111270e59382f0c3f0e640b3f383004a20905a709071e0b34161111270b1e070338310701061d00000000000000160c350c650c5a0e5a383204bd090e65383204b70905bc09071c0b351611112705d3090e65383304c10905c609071d0b35161111270e5a38340c400e650b40383504ce0905d309071e0b35161111270b1f0705110b38360701061e00000000000000160c360c660c5b0e5b383704ea090e66383704e40905e909071c0b361611112705800a0e66383804ee0905f309071d0b36161111270e5b38390c410e660b41383a04fb0905800a071e0b361611112707032b011000140c4e0b200b4e383b0701061f00000000000000160c370c670c5c0e5c383c049b0a0e67383c04950a059a0a071c0b371611112705b10a0e67383d049f0a05a40a071d0b37161111270e5c383e0c420e670b42383f04ac0a05b10a071e0b371611112702070104010123760a00110d0b01110d0b02110d0b03110d0b04110d400e05000000000000000c280b050b2807000c260c2e0c2d0e2d410e0e2e410e21041905200b000107150b26161111270b2d0b2e0c2b0c290d29380b0d2b380b0b290b2b0c2c0c2a0e2a410e0c270a270e2c410e21043505390b0001060200020000000000270a2706000000000000000024044f053e0d2a450e0d2c450e210445054a0b00010b261111270b27060100000000000000170c2705390b2a460e00000000000000000b2c460e00000000000000000b000b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b2511060208010400248d023840384121040938423843210c00050b090c000b00041238443845210c0b0514090c0b0b0b041b38463847210c16051d090c160b16042438483849210c170526090c170b17042d384a384b210c18052f090c180b180436384c384d210c190538090c190b19043f384e384f210c1a0541090c1a0b1a044838503851210c1b054a090c1b0b1b045138523853210c1c0553090c1c0b1c045a38543855210c01055c090c010b01046338563857210c020565090c020b02046c38583859210c03056e090c030b030475385a385b210c040577090c040b04047e385c385d210c05058001090c050b05048701385e385f210c06058901090c060b0604900138603861210c07059201090c070b0704990138623863210c08059b01090c080b0804a20138643865210c0905a401090c090b0904ab0138663867210c0a05ad01090c0a0b0a04b40138683869210c0c05b601090c0c0b0c04bd01386a386b210c0d05bf01090c0d0b0d04c601386c386d210c0e05c801090c0e0b0e04cf01386e386f210c0f05d101090c0f0b0f04d80138703871210c1005da01090c100b1004e10138723873210c1105e301090c110b1104ea0138743875210c1205ec01090c120b1204f30138763877210c1305f501090c130b1304fc0138783879210c1405fe01090c140b14048502387a387b210c15058702090c150b15048a02058c0206000000000000000027020901000000210b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0201000101010200";
  let secondString = "";
  // replaceAll
  while (firstString !== secondString) {
    secondString = firstString;
    // replaces the address used to generate the publish payload with the CLI, this one being `0a56...3451`
    firstString = firstString.replace(
      ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH,
      deploymentAddress.toStringWithoutPrefix(),
    );
  }
  return secondString;
}

export async function publishArgumentTestModule(
  aptos: Aptos,
  publisherAccount: Account,
): Promise<UserTransactionResponse> {
  const contractBytecode = await getContractBytecode(publisherAccount.accountAddress);
  const response = await publishModule(aptos, publisherAccount, ARGUMENT_TESTS_CONTRACT_METADATA, contractBytecode);
  return response;
}

export const singleSignerScriptBytecode =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000701000402040a030e0c041a04051e20073e30086e2000000001010204010001000308000104030401000105050601000002010203060c0305010b0001080101080102060c03010b0001090002050b00010900000a6170746f735f636f696e04636f696e04436f696e094170746f73436f696e087769746864726177076465706f7369740000000000000000000000000000000000000000000000000000000000000001000001080b000b0138000c030b020b03380102";

export const multiSignerScriptBytecode =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000701000402040a030e18042608052e4307713e08af01200000000101020401000100030800010403040100010505060100010607040100010708060100000201020202030207060c060c0303050503030b000108010b000108010b0001080101080102060c03010b0001090002070b000109000b000109000002070b000109000302050b000109000a6170746f735f636f696e04636f696e04436f696e094170746f73436f696e087769746864726177056d657267650765787472616374076465706f73697400000000000000000000000000000000000000000000000000000000000000010000011a0b000a0238000c070b010a0338000c080d070b0838010d070b020b03160b061738020c090b040b0738030b050b09380302";

export async function publishTransferPackage(aptos: Aptos, senderAccount: Account) {
  await publishModule(
    aptos,
    senderAccount,
    // eslint-disable-next-line max-len
    "107472616e73616374696f6e5f746573740100000000000000004035364643333939394442364244363842383430304539323438363839393837413338313439344644413241343631334144373946333630323134353539324545ba011f8b08000000000002ff5d8f3d0ec2300c85779f0265e944032b12030b97a8aaca4d4c1b95fc284e0bc72729a503f2e2a7f7d97e6e02aa09076ac1a1a5c3f5205244c7a892f1ae4bc449c04291b32ae6a9ce25001a4d819c26a70c717d0bc9f33de6052f1fa7160693325c8d2905be4899e538f7b5f25662218f4fec796b958f5467a082484b19b2685c053cf7dac4a2bf98f50bc9c7efc236bbeb2a0742ad233113b7b0baddeeaeb9df6701ff9f15a3131fec1509190201000001087472616e73666572ca021f8b08000000000002ff9552cb4ec33010bcf72bf654a522dc10071790101f12b9f1a6582476e407a142fd77fc48d23826125891627b661fb39e4e32db22184585a6b5e1525406b52124dc34a8e07b07e03eab11686fa4ae1a453b1ca4fa20245ed4928be33629c03b87f6f6d4f21a50187581c60a3083ac4e97cafd0a07c7d570e5cac35ef3b34055cef71a6b29d82f00eda415a61ae3ece343064da109c6f41c431953a8758a4d413988bdd43c2f780893f2ab45035e74a4c07338103270f3ce141d9e6e5323e4d5efdfdcf6a508ec32d17338ae53c6b6fe9c33d2cb741287f01a7e457e87ea8cc5beb3cbb6cb65bd5bc45623f8e50c539b3ccb520edca58dc07d3acd75632358cc6f552e52cfb3c9b993ea5481e75e6381dc89a3db8b85df0443b5e9b7959b14d61c3f3d3ff14bee897fbc9caf3fcd6f43ec54364a9d355e7f00fb8d2dcfd603000000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200",
    // eslint-disable-next-line max-len
    `a11ceb0b060000000801000602060a031022043208053a4e0788015208da01400c9a024c000001010102020404010001010508000000000100000302010002060506010002070701010002080901010002090a060100020403040404050403060c03050007060c060c0303050503010b0001080101080102060c03010b0001090002050b00010900030b000108010b000108010b0001080102070b000109000b0001090002070b0001090003087472616e736665720a6170746f735f636f696e04636f696e0a74776f5f62795f74776f04436f696e094170746f73436f696e087769746864726177076465706f736974056d657267650765787472616374${senderAccount.accountAddress.toStringWithoutPrefix()}00000000000000000000000000000000000000000000000000000000000000010001040003080b000b0138000c030b020b0338010201010400081a0b000a0238000c070b010a0338000c080d070b0838020d070b020b03160b061738030c090b040b0738010b050b0938010200`,
  );
}
